{"version":3,"sources":["AppDataAttributeHandler.js"],"names":[],"mappings":"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","file":"src/app/AppDataAttributeHandler.js","sourcesContent":["'use strict';\n\nimport { core, object, Disposable } from 'metal';\nimport dataAttributes from './dataAttributes';\nimport globals from '../globals/globals';\nimport App from './App';\nimport HtmlScreen from '../screen/HtmlScreen';\nimport Route from '../route/Route';\n\nclass AppDataAttributeHandler extends Disposable {\n\n\t/**\n\t * Initilizes App, register surfaces and routes from data attributes.\n\t * @constructor\n\t */\n\tconstructor() {\n\t\tsuper();\n\n\t\t/**\n\t\t * Holds the app reference initialized by data attributes.\n\t\t * @type {App}\n\t\t * @default null\n\t\t */\n\t\tthis.app = null;\n\n\t\t/**\n\t\t * Holds the base element to search initialization data attributes. This\n\t\t * element is the container used to enable initialization based on the\n\t\t * presence of `data-senna` attribute.\n\t\t * @type {Element}\n\t\t * @default null\n\t\t */\n\t\tthis.baseElement = null;\n\t}\n\n\t/**\n\t * Inits application based on information scanned from document.\n\t */\n\thandle() {\n\t\tif (!core.isElement(this.baseElement)) {\n\t\t\tthrow new Error('Senna data attribute handler base element ' +\n\t\t\t\t'not set or invalid, try setting a valid element that ' +\n\t\t\t\t'contains a `data-senna` attribute.');\n\t\t}\n\n\t\tif (!this.baseElement.hasAttribute(dataAttributes.senna)) {\n\t\t\tconsole.log('Senna was not initialized from data attributes. ' +\n\t\t\t\t'In order to enable its usage from data attributes try setting ' +\n\t\t\t\t'in the base element, e.g. `<body data-senna>`.');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.app) {\n\t\t\tthrow new Error('Senna app was already initialized.');\n\t\t}\n\n\t\tconsole.log('Senna initialized from data attribute.');\n\n\t\tthis.app = new App();\n\t\tthis.maybeAddRoutes_();\n\t\tthis.maybeAddSurfaces_();\n\t\tthis.maybeSetBasePath_();\n\t\tthis.maybeSetLinkSelector_();\n\t\tthis.maybeSetLoadingCssClass_();\n\t\tthis.maybeSetUpdateScrollPosition_();\n\t\tthis.maybeDispatch_();\n\t}\n\n\t/**\n\t * Disposes of this instance's object references.\n\t * @override\n\t */\n\tdisposeInternal() {\n\t\tif (this.app) {\n\t\t\tthis.app.dispose();\n\t\t}\n\t}\n\n\t/**\n\t * Gets the app reference.\n\t * @return {App}\n\t */\n\tgetApp() {\n\t\treturn this.app;\n\t}\n\n\t/**\n\t * Gets the base element.\n\t * @return {Element} baseElement\n\t */\n\tgetBaseElement() {\n\t\treturn this.baseElement;\n\t}\n\n\t/**\n\t * Maybe adds app routes from link elements that are `senna-route`.\n\t */\n\tmaybeAddRoutes_() {\n\t\tvar routesSelector = 'link[rel=\"senna-route\"]';\n\t\tthis.querySelectorAllAsArray_(routesSelector).forEach((link) => this.maybeParseLinkRoute_(link));\n\t\tif (!this.app.hasRoutes()) {\n\t\t\tthis.app.addRoutes(new Route(/.*/, HtmlScreen));\n\t\t\tconsole.log('Senna can\\'t find route elements, adding default.');\n\t\t}\n\t}\n\n\t/**\n\t * Maybe adds app surfaces by scanning `data-senna-surface` data attribute.\n\t */\n\tmaybeAddSurfaces_() {\n\t\tvar surfacesSelector = '[' + dataAttributes.surface + ']';\n\t\tthis.querySelectorAllAsArray_(surfacesSelector).forEach((surfaceElement) => {\n\t\t\tthis.updateElementIdIfSpecialSurface_(surfaceElement);\n\t\t\tthis.app.addSurfaces(surfaceElement.id);\n\t\t});\n\t}\n\n\t/**\n\t * Dispatches app navigation to the current path when initializes.\n\t */\n\tmaybeDispatch_() {\n\t\tif (this.baseElement.hasAttribute(dataAttributes.dispatch)) {\n\t\t\tthis.app.dispatch();\n\t\t}\n\t}\n\n\t/**\n\t * Adds app route by parsing valid link elements. A valid link element is of\n\t * the kind `rel=\"senna-route\"`.\n\t * @param {Element} link\n\t */\n\tmaybeParseLinkRoute_(link) {\n\t\tvar route = new Route(this.maybeParseLinkRoutePath_(link), this.maybeParseLinkRouteHandler_(link));\n\t\tthis.app.addRoutes(route);\n\t\tconsole.log('Senna scanned route ' + route.getPath());\n\t}\n\n\t/**\n\t * Maybe parse link route handler.\n\t * @param {Element} link\n\t * @return {?string}\n\t */\n\tmaybeParseLinkRouteHandler_(link) {\n\t\tvar handler = link.getAttribute('type');\n\t\tif (core.isDefAndNotNull(handler)) {\n\t\t\thandler = object.getObjectByName(handler);\n\t\t}\n\t\treturn handler;\n\t}\n\n\t/**\n\t * Maybe parse link route path.\n\t * @param {Element} link\n\t * @return {?string}\n\t */\n\tmaybeParseLinkRoutePath_(link) {\n\t\tvar path = link.getAttribute('href');\n\t\tif (core.isDefAndNotNull(path)) {\n\t\t\tif (path.indexOf('regex:') === 0) {\n\t\t\t\tpath = new RegExp(path.substring(6));\n\t\t\t}\n\t\t}\n\t\treturn path;\n\t}\n\n\t/**\n\t * Maybe sets app base path from `data-senna-base-path` data attribute.\n\t */\n\tmaybeSetBasePath_() {\n\t\tvar basePath = this.baseElement.getAttribute(dataAttributes.basePath);\n\t\tif (core.isDefAndNotNull(basePath)) {\n\t\t\tthis.app.setBasePath(basePath);\n\t\t\tconsole.log('Senna scanned base path ' + basePath);\n\t\t}\n\t}\n\n\t/**\n\t * Maybe sets app link selector from `data-senna-link-selector` data\n\t * attribute.\n\t */\n\tmaybeSetLinkSelector_() {\n\t\tvar linkSelector = this.baseElement.getAttribute(dataAttributes.linkSelector);\n\t\tif (core.isDefAndNotNull(linkSelector)) {\n\t\t\tthis.app.setLinkSelector(linkSelector);\n\t\t\tconsole.log('Senna scanned link selector ' + linkSelector);\n\t\t}\n\t}\n\n\t/**\n\t * Maybe sets app link loading css class from `data-senna-loading-css-class`\n\t * data attribute.\n\t */\n\tmaybeSetLoadingCssClass_() {\n\t\tvar loadingCssClass = this.baseElement.getAttribute(dataAttributes.loadingCssClass);\n\t\tif (core.isDefAndNotNull(loadingCssClass)) {\n\t\t\tthis.app.setLoadingCssClass(loadingCssClass);\n\t\t\tconsole.log('Senna scanned loading css class ' + loadingCssClass);\n\t\t}\n\t}\n\n\t/**\n\t * Maybe sets app update scroll position from\n\t * `data-senna-update-scroll-position` data attribute.\n\t */\n\tmaybeSetUpdateScrollPosition_() {\n\t\tvar updateScrollPosition = this.baseElement.getAttribute(dataAttributes.updateScrollPosition);\n\t\tif (core.isDefAndNotNull(updateScrollPosition)) {\n\t\t\tif (updateScrollPosition === 'false') {\n\t\t\t\tthis.app.setUpdateScrollPosition(false);\n\t\t\t} else {\n\t\t\t\tthis.app.setUpdateScrollPosition(true);\n\t\t\t}\n\t\t\tconsole.log('Senna scanned update scroll position ' + updateScrollPosition);\n\t\t}\n\t}\n\n\t/**\n\t * Queries elements from document and returns an array of elements.\n\t * @param {!string} selector\n\t * @return {array.<Element>}\n\t */\n\tquerySelectorAllAsArray_(selector) {\n\t\treturn Array.prototype.slice.call(globals.document.querySelectorAll(selector));\n\t}\n\n\t/**\n\t * Updates element id if handled as special surface element. Some surfaces\n\t * are slightly different from others, like when threating <code>body</code>\n\t * as surface.\n\t * @param {Element} element\n\t */\n\tupdateElementIdIfSpecialSurface_(element) {\n\t\tif (!element.id && element === globals.document.body) {\n\t\t\telement.id = 'senna_surface_' + core.getUid();\n\t\t}\n\t}\n\n\t/**\n\t * Sets the base element.\n\t * @param {Element} baseElement\n\t */\n\tsetBaseElement(baseElement) {\n\t\tthis.baseElement = baseElement;\n\t}\n\n}\n\nexport default AppDataAttributeHandler;\n"],"sourceRoot":"/source/"}